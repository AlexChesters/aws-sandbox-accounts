version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.12
  build:
    commands:
      - cd apps/account-manager
      - curl --location "https://github.com/rebuy-de/aws-nuke/releases/download/v2.25.0/aws-nuke-v2.25.0-linux-amd64.tar.gz" -o aws-nuke.tar.gz
      - tar -xvf aws-nuke.tar.gz
      - echo "running aws-nuke against $ACCOUNT_ID"
      - make install_poetry
      - make install
      - make nuke-config
      - ./aws-nuke-v2.25.0-linux-amd64 --no-dry-run --config aws-nuke.yml --assume-role-arn "arn:aws:iam::$ACCOUNT_ID:role/aws-sandbox-accounts-aws-nuke" --force --force-sleep 1
