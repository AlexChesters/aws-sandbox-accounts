FROM public.ecr.aws/ubuntu/ubuntu:22.04

ARG DEBIAN_FRONTEND=noninteractive

# install packages
RUN apt-get update -y && apt-get install -y \
    git \
    make \
    unzip \
    curl \
    software-properties-common \
    mysql-client \
    pipx \
    pkg-config \
    vim

# configure environment variables
ENV EDITOR=vim

# install aws-cli
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip" && unzip awscliv2.zip
RUN ./aws/install

# install rain
RUN curl -L -o /tmp/rain.zip https://github.com/aws-cloudformation/rain/releases/download/v1.23.0/rain-v1.23.0_linux-arm64.zip
RUN unzip /tmp/rain.zip
RUN mv ./rain-v1.23.0_linux-arm64/rain /usr/local/bin/rain

# install python
RUN add-apt-repository ppa:deadsnakes/ppa -y && \
    apt-get update -y && \
    apt-get install -y python3.11 python3.11-venv python3.11-dev python3-pip
RUN python3.11 -m pip install --upgrade pip

# install cfn-lint
RUN pip install cfn-lint

# install poetry
RUN pipx install poetry==2.1.2
ENV PATH="$PATH:/root/.local/bin"
RUN poetry config virtualenvs.options.always-copy true
RUN poetry config virtualenvs.in-project true

# install nodejs
RUN curl -fsSL https://deb.nodesource.com/setup_22.x | bash -
RUN apt-get install -y nodejs

# configure bash aliases
RUN echo "alias ls='ls -alh'" >> /root/.bashrc
RUN echo "alias gco='git checkout'" >> /root/.bashrc
RUN echo "alias gs='git status'" >> /root/.bashrc
RUN echo "alias ga='git add .'" >> /root/.bashrc
RUN echo "alias gc='git commit'" >> /root/.bashrc
